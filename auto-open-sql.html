<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Supabase SQL ì‹¤í–‰ê¸°</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #3FCF8E;
            padding-bottom: 10px;
        }
        .step {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-left: 4px solid #3FCF8E;
        }
        .step h3 {
            margin-top: 0;
            color: #555;
        }
        button {
            background: #3FCF8E;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #2FA876;
        }
        textarea {
            width: 100%;
            height: 200px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: vertical;
        }
        .success {
            color: #3FCF8E;
            font-weight: bold;
        }
        .error {
            color: #ff4444;
            font-weight: bold;
        }
        #status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        #status.success {
            background: #e8f5e9;
            border: 1px solid #3FCF8E;
            display: block;
        }
        #status.error {
            background: #ffebee;
            border: 1px solid #ff4444;
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Supabase í…Œì´ë¸” ìë™ ìƒì„±ê¸°</h1>
        
        <div class="step">
            <h3>Step 1: SQL í™•ì¸</h3>
            <p>ì•„ë˜ SQLì´ ì‹¤í–‰ë©ë‹ˆë‹¤:</p>
            <textarea id="sqlContent" readonly></textarea>
            <button onclick="copySql()">ğŸ“‹ SQL ë³µì‚¬</button>
        </div>
        
        <div class="step">
            <h3>Step 2: Supabase SQL Editor ì—´ê¸°</h3>
            <button onclick="openSupabase()">ğŸ”— Supabase SQL Editor ì—´ê¸°</button>
            <p style="font-size: 14px; color: #666;">
                1. ìœ„ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ Supabase SQL Editorê°€ ì—´ë¦½ë‹ˆë‹¤<br>
                2. ë¡œê·¸ì¸ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤<br>
                3. SQL Editor í˜ì´ì§€ê°€ ì—´ë¦¬ë©´ Step 3ë¡œ ì§„í–‰í•˜ì„¸ìš”
            </p>
        </div>
        
        <div class="step">
            <h3>Step 3: SQL ì‹¤í–‰</h3>
            <p>
                1. Step 1ì—ì„œ ë³µì‚¬í•œ SQLì„ SQL Editorì— ë¶™ì—¬ë„£ê¸° (Cmd+V)<br>
                2. "Run" ë²„íŠ¼ í´ë¦­<br>
                3. ì„±ê³µ ë©”ì‹œì§€ê°€ ë‚˜íƒ€ë‚˜ë©´ ì™„ë£Œ!
            </p>
        </div>
        
        <div class="step">
            <h3>Step 4: ì•± í™•ì¸</h3>
            <button onclick="window.location.reload()">ğŸ”„ ì´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨</button>
            <button onclick="window.open('http://localhost:5173', '_blank')">ğŸ“± ì•± ì—´ê¸°</button>
        </div>
        
        <div id="status"></div>
    </div>
    
    <script>
        // SQL ë‚´ìš© ë¡œë“œ
        const sqlContent = `-- =====================================================
-- Channel Management Tables for Campaign Management System
-- =====================================================

-- Channel Types Table
CREATE TABLE IF NOT EXISTS public.channel_types (
  id SERIAL PRIMARY KEY,
  code VARCHAR(50) UNIQUE NOT NULL,
  name VARCHAR(100) NOT NULL,
  description TEXT,
  icon VARCHAR(10),
  color VARCHAR(20),
  display_order INTEGER NOT NULL DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

ALTER TABLE public.channel_types ENABLE ROW LEVEL SECURITY;

-- Channel Attributes Table
CREATE TABLE IF NOT EXISTS public.channel_attributes (
  id SERIAL PRIMARY KEY,
  code VARCHAR(50) UNIQUE NOT NULL,
  name VARCHAR(100) NOT NULL,
  data_type VARCHAR(20) NOT NULL CHECK (data_type IN ('text', 'number', 'date', 'boolean', 'url', 'email')),
  is_required BOOLEAN DEFAULT FALSE,
  is_common BOOLEAN DEFAULT TRUE,
  display_order INTEGER NOT NULL DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

ALTER TABLE public.channel_attributes ENABLE ROW LEVEL SECURITY;

-- Channel Type Attributes Junction Table
CREATE TABLE IF NOT EXISTS public.channel_type_attributes (
  id SERIAL PRIMARY KEY,
  channel_type_id INTEGER NOT NULL REFERENCES public.channel_types(id) ON DELETE CASCADE,
  attribute_id INTEGER NOT NULL REFERENCES public.channel_attributes(id) ON DELETE CASCADE,
  is_required BOOLEAN DEFAULT FALSE,
  display_order INTEGER NOT NULL DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(channel_type_id, attribute_id)
);

ALTER TABLE public.channel_type_attributes ENABLE ROW LEVEL SECURITY;

-- Channels Table V2
CREATE TABLE IF NOT EXISTS public.channels_v2 (
  id SERIAL PRIMARY KEY,
  channel_type_id INTEGER NOT NULL REFERENCES public.channel_types(id),
  name VARCHAR(255) NOT NULL,
  url VARCHAR(500),
  member_count INTEGER,
  email VARCHAR(255),
  contact_person VARCHAR(100),
  contact_phone VARCHAR(50),
  main_phone VARCHAR(50),
  address TEXT,
  memo TEXT,
  registration_date DATE,
  update_date DATE,
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

ALTER TABLE public.channels_v2 ENABLE ROW LEVEL SECURITY;

-- RLS Policies
CREATE POLICY "Enable all access" ON public.channel_types FOR ALL USING (true);
CREATE POLICY "Enable all access" ON public.channel_attributes FOR ALL USING (true);
CREATE POLICY "Enable all access" ON public.channel_type_attributes FOR ALL USING (true);
CREATE POLICY "Enable all access" ON public.channels_v2 FOR ALL USING (true);

-- Update trigger function
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Add triggers
CREATE TRIGGER update_channel_types_updated_at BEFORE UPDATE ON public.channel_types
  FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
CREATE TRIGGER update_channel_attributes_updated_at BEFORE UPDATE ON public.channel_attributes
  FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
CREATE TRIGGER update_channel_type_attributes_updated_at BEFORE UPDATE ON public.channel_type_attributes
  FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
CREATE TRIGGER update_channels_v2_updated_at BEFORE UPDATE ON public.channels_v2
  FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

-- Insert channel types
INSERT INTO public.channel_types (code, name, description, color, display_order) VALUES
  ('platform_service', 'í”Œë«í¼ì„œë¹„ìŠ¤', 'ì˜¨ë¼ì¸ í”Œë«í¼ ë° ì„œë¹„ìŠ¤', 'blue', 1),
  ('government', 'ì •ë¶€ê¸°ê´€', 'ì •ë¶€ ë° ê³µê³µê¸°ê´€', 'gray', 2),
  ('competition', 'ê³µëª¨ì „', 'ê³µëª¨ì „ ë° ëŒ€íšŒ', 'yellow', 3),
  ('portal_cafe', 'í¬í„¸ì¹´í˜', 'ë„¤ì´ë²„/ë‹¤ìŒ ì¹´í˜', 'amber', 4),
  ('sns_group', 'SNSê·¸ë£¹', 'í˜ì´ìŠ¤ë¶, ì¸ìŠ¤íƒ€ê·¸ë¨ ë“±', 'purple', 5),
  ('community', 'ì»¤ë®¤ë‹ˆí‹°', 'ì˜¨ë¼ì¸ ì»¤ë®¤ë‹ˆí‹°', 'green', 6),
  ('open_chat', 'ì˜¤í”ˆë‹¨í†¡ë°©', 'ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ…', 'pink', 7),
  ('discord', 'ë””ìŠ¤ì½”ë“œ', 'ë””ìŠ¤ì½”ë“œ ì„œë²„', 'indigo', 8),
  ('official_graduate', 'ê³µë¬¸-ëŒ€í•™ì›', 'ëŒ€í•™ì› ê³µì‹ ì±„ë„', 'blue', 9),
  ('official_university', 'ê³µë¬¸-ëŒ€í•™êµ', 'ëŒ€í•™êµ ê³µì‹ ì±„ë„', 'blue', 10),
  ('official_highschool', 'ê³µë¬¸-ê³ ë“±í•™êµ', 'ê³ ë“±í•™êµ ê³µì‹ ì±„ë„', 'blue', 11),
  ('dm_academic', 'DM-í•™íšŒ', 'í•™íšŒ DM ì±„ë„', 'red', 12),
  ('dm_association', 'DM-í˜‘íšŒ', 'í˜‘íšŒ DM ì±„ë„', 'red', 13),
  ('dm_university', 'DM-ëŒ€í•™', 'ëŒ€í•™ DM ì±„ë„', 'red', 14),
  ('outdoor_university', 'ì˜¥ì™¸ê´‘ê³ -ëŒ€í•™', 'ëŒ€í•™ ì˜¥ì™¸ê´‘ê³ ', 'teal', 15),
  ('outdoor_nst', 'ì˜¥ì™¸ê´‘ê³ -ì¶œì—°ì—°NST', 'ì¶œì—°ì—° ì˜¥ì™¸ê´‘ê³ ', 'teal', 16),
  ('outdoor_partner', 'ì˜¥ì™¸ê´‘ê³ -í˜‘ë ¥ê¸°ê´€', 'í˜‘ë ¥ê¸°ê´€ ì˜¥ì™¸ê´‘ê³ ', 'teal', 17),
  ('performance', 'í¼í¬ë¨¼ìŠ¤', 'í¼í¬ë¨¼ìŠ¤ ë§ˆì¼€íŒ…', 'cyan', 18),
  ('event_site', 'ì´ë²¤íŠ¸ì‚¬ì´íŠ¸', 'ì´ë²¤íŠ¸ ì‚¬ì´íŠ¸', 'amber', 19)
ON CONFLICT (code) DO NOTHING;

-- Insert attributes
INSERT INTO public.channel_attributes (code, name, data_type, display_order) VALUES
  ('name', 'ì´ë¦„', 'text', 1),
  ('registration_date', 'ë“±ë¡ì¼', 'date', 2),
  ('update_date', 'ê°±ì‹ ì¼', 'date', 3),
  ('memo', 'ë©”ëª¨', 'text', 4),
  ('member_count', 'ì¸ì›', 'number', 5),
  ('url', 'URL', 'url', 6),
  ('email', 'ì´ë©”ì¼', 'email', 7),
  ('contact_person', 'ë‹´ë‹¹ì', 'text', 8),
  ('contact_phone', 'ì—°ë½ì²˜', 'text', 9),
  ('main_phone', 'ëŒ€í‘œì „í™”', 'text', 10),
  ('address', 'ì£¼ì†Œ', 'text', 11),
  ('is_active', 'ë¹„í™œì„±í™”', 'boolean', 12)
ON CONFLICT (code) DO NOTHING;

-- Set default type-attribute relationships
INSERT INTO public.channel_type_attributes (channel_type_id, attribute_id, is_required, display_order)
SELECT 
  ct.id as channel_type_id,
  ca.id as attribute_id,
  CASE WHEN ca.code = 'name' THEN TRUE ELSE FALSE END as is_required,
  ca.display_order
FROM public.channel_types ct
CROSS JOIN public.channel_attributes ca
WHERE ca.code IN ('name', 'registration_date', 'update_date', 'memo')
ON CONFLICT (channel_type_id, attribute_id) DO NOTHING;`;

        document.getElementById('sqlContent').value = sqlContent;
        
        function copySql() {
            const textarea = document.getElementById('sqlContent');
            textarea.select();
            document.execCommand('copy');
            
            const status = document.getElementById('status');
            status.className = 'success';
            status.innerHTML = 'âœ… SQLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!';
            status.style.display = 'block';
            
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }
        
        function openSupabase() {
            window.open('https://supabase.com/dashboard/project/zaivjzyuxyajadfwfbkx/sql/new', '_blank');
        }
    </script>
</body>
</html>