<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Campaign Postings í…Œì´ë¸” ìƒì„±</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #3FCF8E;
            padding-bottom: 10px;
        }
        .status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .status.success {
            background: #e8f5e9;
            border: 1px solid #4caf50;
            color: #2e7d32;
        }
        .status.error {
            background: #ffebee;
            border: 1px solid #f44336;
            color: #c62828;
        }
        .status.info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            color: #1565c0;
        }
        button {
            background: #3FCF8E;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #2FA876;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        textarea {
            width: 100%;
            height: 300px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: vertical;
        }
        .step {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-left: 4px solid #3FCF8E;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3FCF8E;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š Campaign Postings í…Œì´ë¸” ìƒì„±</h1>
        
        <div class="status info">
            <strong>ì¤€ë¹„:</strong> ê²Œì¬ ê´€ë¦¬ ê¸°ëŠ¥ì„ ìœ„í•œ í…Œì´ë¸”ì„ ìƒì„±í•©ë‹ˆë‹¤.
        </div>

        <div class="step">
            <h3>SQL ë‚´ìš©:</h3>
            <textarea id="sqlContent" readonly></textarea>
        </div>

        <div class="step">
            <button id="executeBtn" onclick="executeSql()">
                ğŸš€ SQL ì‹¤í–‰í•˜ê¸°
            </button>
            <button onclick="copySql()">
                ğŸ“‹ SQL ë³µì‚¬
            </button>
            <button onclick="openSupabase()">
                ğŸ”— Supabase SQL Editor ì—´ê¸°
            </button>
        </div>

        <div id="result"></div>
    </div>

    <script>
        const SUPABASE_URL = 'https://zaivjzyuxyajadfwfbkx.supabase.co';
        const ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InphaXZqenl1eHlhamFkZndmYmt4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3NzU0ODcsImV4cCI6MjA4MDM1MTQ4N30.oUUulgOnIpnQCcuG7IvzYB0MT_FzPlWzqz2qh3orXPY';
        
        const sql = `-- Campaign Postings Table for tracking channel postings per campaign
CREATE TABLE IF NOT EXISTS public.campaign_postings (
  id SERIAL PRIMARY KEY,
  campaign_id INTEGER REFERENCES public.campaigns(id) ON DELETE CASCADE,
  channel_id INTEGER REFERENCES public.channels_v2(id) ON DELETE CASCADE,
  status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'in_progress', 'completed', 'failed')),
  result TEXT,
  memo TEXT,
  posted_date DATE,
  metrics JSONB,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(campaign_id, channel_id)
);

-- Enable RLS
ALTER TABLE public.campaign_postings ENABLE ROW LEVEL SECURITY;

-- Create RLS policy
CREATE POLICY "Enable all access for campaign_postings" 
  ON public.campaign_postings 
  FOR ALL 
  USING (true);

-- Create trigger for updated_at
CREATE TRIGGER update_campaign_postings_updated_at 
  BEFORE UPDATE ON public.campaign_postings
  FOR EACH ROW 
  EXECUTE FUNCTION update_updated_at_column();

-- Create indexes for better performance
CREATE INDEX idx_campaign_postings_campaign_id ON public.campaign_postings(campaign_id);
CREATE INDEX idx_campaign_postings_channel_id ON public.campaign_postings(channel_id);
CREATE INDEX idx_campaign_postings_status ON public.campaign_postings(status);`;

        document.getElementById('sqlContent').value = sql;

        function copySql() {
            const textarea = document.getElementById('sqlContent');
            textarea.select();
            document.execCommand('copy');
            
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div class="status success">âœ… SQLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</div>';
            
            setTimeout(() => {
                resultDiv.innerHTML = '';
            }, 3000);
        }

        function openSupabase() {
            window.open('https://supabase.com/dashboard/project/zaivjzyuxyajadfwfbkx/sql/new', '_blank');
        }

        async function executeSql() {
            const btn = document.getElementById('executeBtn');
            const resultDiv = document.getElementById('result');
            
            btn.disabled = true;
            btn.innerHTML = 'ì‹¤í–‰ ì¤‘... <span class="spinner"></span>';
            
            resultDiv.innerHTML = '<div class="status info">ğŸ“¡ Supabaseì— ì—°ê²° ì¤‘...</div>';
            
            // Manual execution guide since we can't directly execute DDL via API
            setTimeout(() => {
                resultDiv.innerHTML = `
                    <div class="status error">
                        <strong>ìë™ ì‹¤í–‰ ë¶ˆê°€:</strong> 
                        í…Œì´ë¸” ìƒì„±ì€ Supabase SQL Editorì—ì„œ ì§ì ‘ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.
                    </div>
                    <div class="status info">
                        <strong>ìˆ˜ë™ ì‹¤í–‰ ë°©ë²•:</strong><br>
                        1. "SQL ë³µì‚¬" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ SQL ë³µì‚¬<br>
                        2. "Supabase SQL Editor ì—´ê¸°" ë²„íŠ¼ í´ë¦­<br>
                        3. SQL Editorì— ë¶™ì—¬ë„£ê³  "Run" í´ë¦­<br>
                        4. ì„±ê³µ ë©”ì‹œì§€ í™•ì¸ í›„ ì•±ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                    </div>
                `;
                
                btn.disabled = false;
                btn.innerHTML = 'ğŸš€ SQL ì‹¤í–‰í•˜ê¸°';
                
                // Auto open Supabase
                openSupabase();
            }, 1500);
        }

        // Auto-copy on page load
        window.addEventListener('load', () => {
            copySql();
            document.getElementById('result').innerHTML = `
                <div class="status success">
                    âœ… SQLì´ ìë™ìœ¼ë¡œ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!<br>
                    Supabase SQL Editorì—ì„œ ë¶™ì—¬ë„£ê¸°(Cmd+V) í•˜ì„¸ìš”.
                </div>
            `;
        });
    </script>
</body>
</html>